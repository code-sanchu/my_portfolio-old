---
import "../styles/global.css";

import Navigation from "../components/Navigation.astro";

export interface Props {
  pageTitle?: string;
}

declare global {
  interface Window {
    awaitingPageChange: boolean;
    isMousedOverProjects: boolean;
  }
}

// const { pageTitle } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>VirtualWorks. Curated Sites.</title>
    <link rel="stylesheet" href="https://use.typekit.net/ewe1rrd.css" />
  </head>
  <body id="body" class="w-screen overflow-x-hidden">
    <Navigation />
    <div class="w-full min-h-screen" id="content-container">
      <slot />
    </div>
  </body>
</html>

<script>
  import anime from "animejs";
  import { projectIdString } from "~data/idString";

  function handlePageChangeOnMouseWheel() {
    const body = document.getElementById("body")!;

    body.addEventListener("wheel", (event) => {
      if (window.awaitingPageChange) {
        return;
      }
      const currentLocation = window.location.pathname;

      const isNextPage = currentLocation === "/" || currentLocation === "/work";
      const isPrevPage =
        currentLocation === "/work" || currentLocation === "/services";

      if (!isNextPage && !isPrevPage) {
        return;
      }

      if (window.isMousedOverProjects) {
        return;
      }

      const direction = event.deltaY < 0 ? "up" : "down";

      if (isNextPage && direction === "down") {
        window.awaitingPageChange = true;

        const nextPageRoute = currentLocation === "/" ? "/work" : "/services";

        fadePageOut();

        setTimeout(() => {
          window.awaitingPageChange = false;
          window.location.href = nextPageRoute;
        }, 450);
      }
      if (isPrevPage && direction === "up") {
        window.awaitingPageChange = true;

        const nextPageRoute = currentLocation === "/work" ? "/" : "/work";

        fadePageOut();

        setTimeout(() => {
          window.awaitingPageChange = false;
          window.location.href = nextPageRoute;
        }, 450);
      }
    });
  }

  function fadePageOut() {
    anime({
      targets: "#content-container",
      opacity: 0,
      easing: "easeOutCubic",
      duration: 400,
    });
  }

  function trackProjectsContainerIsMousedOverOnWorkPage() {
    const currentLocation = window.location.pathname;

    if (currentLocation !== "/work") {
      return;
    }

    const projectsContainer = document.getElementById(
      projectIdString.projectsContainer
    );

    if (!projectsContainer) {
      return;
    }

    projectsContainer.addEventListener("mouseover", () => {
      window.isMousedOverProjects = true;
    });
    projectsContainer.addEventListener("mouseleave", () => {
      window.isMousedOverProjects = false;
    });
  }

  const main = () => {
    trackProjectsContainerIsMousedOverOnWorkPage();
    handlePageChangeOnMouseWheel();
  };

  main();
</script>
